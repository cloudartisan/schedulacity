<div class="row">
  <div class="col-xs-10 col-xs-offset-1 col-sm-4 col-sm-offset-4">
    <h1>New Event</h1>
  </div>
</div>

<div class="row">
  <div class="col-xs-10 col-xs-offset-1 col-sm-4 col-sm-offset-4">
    <%= bootstrap_form_for :event, url: events_path do |f| %>

      <%# f.select :classgroup_id, Classgroup.all.collect {|c| [ c.name, c.id ] }, { include_blank: true }, label: { text: "Class" } %>
      <label>Class</label>
      <div class="form-group">
        <select name="event[classgroup_id]" class="form-control">
          <% Classgroup.all.each do |c| %>
            <option value="<%=c.id%>"><%=c.name%></option>
          <% end %>
        </select>
      </div>
      <input type="hidden" name="UTC" id="UTC" value="0">
      <label>Address</label>
      <div class="form-group">
        <input type="text" name="event[street]" placeholder="Street Address" class="form-control">
      </div>
      <div class="form-group">
        <div class="form-inline">
          <div class="form-group">
            <input type="text" name"event[city]" placeholder="City", class="form-control">
            <input type="text" name="event[state]" placeholder="State", class="form-control">
            <input type="text" name="event[zip]" placeholder="Zip", class="form-control">
          </div>
        </div>
      </div>

      <label>When</label>
      <div class="form-inline">
        <div class="form-group">
          <!-- <label>Start</label> -->
          <div class='input-group date' id='event_start'>
            <input type='text' name="event[start]" class="form-control" placeholder="Start"/>
            <span class="input-group-addon">
              <span class="glyphicon glyphicon-calendar"></span>
            </span>
          </div>
        </div>

        <div class="form-group pull-right">
          <!-- <label>End</label> -->
          <div class='input-group date' id='event_end'>
            <input type='text' name="event[end]" class="form-control" placeholder="End"/>
            <span class="input-group-addon">
              <span class="glyphicon glyphicon-calendar"></span>
            </span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="checkbox">
          <label>
            <input type="checkbox" id="repeat" name="event[repeat][repeat]" value="true"> Repeat
          </label>
        </div>
      </div>

      <div id="repeat_info" style="display: none;">

        <div class="form-group">
          <label>Repeats</label>
          <select class="form-control" name="event[repeat][reoccurrence_type]">
            <option value="week">Weekly</option>
            <!-- <option value="day">Daily</option> -->
            <!-- <option>3</option> -->
            <!-- <option>4</option> -->
            <!-- <option>5</option> -->
          </select>
        </div>

        <div class="form-group">
          <label>Repeats Every</label>
          <select class="form-control" name="event[repeat][reoccurrence_period]">
            <% (1..30).each do |n| %>
              <option value="<%=n%>"><%=n%> weeks</option>
            <% end %>
          </select>
        </div>

        <div class="form-group">
          <label>Repeat On: </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][sun]" id="cb-sun" value="0"> S
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][mon]" id="cb-mon" value="1"> M
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][tue]" id="cb-tue" value="2"> T
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][wed]" id="cb-wed" value="3"> W
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][thu]" id="cb-thu" value="4"> T
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][fri]" id="cb-fri" value="5"> F
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" name="event[repeat][days][sat]" id="cb-sat" value="6"> S
          </label>
        </div>

        <div class="form-group">
          <div class="form-group">
          <div class="form-inline">
            <label>Ends:</label>
            <div class="radio">
              <label>
                <input type="radio" name="event[repeat][end_mode]" id="options_occurrences" value="occurrences" checked>
                After <input type="text" name="event[repeat][occurrences]" id="occurrences"> occurances
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="form-inline">
            <label>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</label>
            <div class="radio">
              <label>
                <input type="radio" name="event[repeat][end_mode]" id="options_end_date" value="end_date">
                On <input type='text' name="event[repeat][end_date]" id="end_date" disabled>
              </label>
            </div>
          </div>
        </div>
        </div>

      </div> <!-- End repeat_info -->

      <div class="text-center">
        <%= f.submit %>
      </div>

    <% end %>
  </div>
</div>

<script type="text/javascript">
    $(function () {

      // Set the UTC offset
      $('#UTC').val(moment().format("Z"))

      // Initiate datetimepicker for event start
      $('#event_start').datetimepicker({
        sideBySide: true
      });

      // Initiate datetimepicker for event end
      $('#event_end').datetimepicker({
        sideBySide: true
      });

      // Initiate datepicker for repeat end
      $('#end_date').datetimepicker({
        format: 'MM/DD/YYYY'
      });

      // If the event_start date changes; set the minimum date to that date
      // for the event end date
      $("#event_start").on("dp.change", function (e) {
        $('#event_end').data("DateTimePicker").minDate(e.date);
      });
      // $("#event_end").on("dp.change", function (e) {
      //   $('#event_start').data("DateTimePicker").maxDate(e.date);
      // });


      // Show/hide repeat event fields
      $('#repeat').click(function() {
        console.log($(this));
        console.log($(this).prop('checked'));

        if ($(this).prop('checked') === true) {
          $('#repeat_info').show();
        } else {
          $('#repeat_info').hide();
        }
      })

      // Enable disable repeat_times and repeat_end
      $('#options_occurrences').click(function() {
        $('#occurrences').prop('disabled',false)
        $('#end_date').prop('disabled',true)
      })

      $('#options_end_date').click(function() {
        $('#occurrences').prop('disabled',true)
        $('#end_date').prop('disabled',false)
      })

    });
</script>
